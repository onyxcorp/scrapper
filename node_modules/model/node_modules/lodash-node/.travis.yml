language: node_js
node_js:
  - "0.6"
  - "0.8"
  - "0.10"
env:
  global:
    - BIN="node" MAKE=false
    - secure: "b4ZKDjezf7wDMt2VAtTAgeJWZBtPG0KTdGkvmpHpxTSx+f+S9K+DCK1W+wC6ApX1MCA6i9bw9fYtGeh4A21CTOPeBqhQ/oMkhqWLe5DxMhvj1s2yPMRnlbJtayuDgW5/PwTmEZ2AFHRZ2mBQ6vyCCkg9RsV37lrzm7ify53tzJY="
  matrix:
    - BUILD="compat"
    - BUILD="modern"
    - BUILD="legacy"
    - BUILD="mobile"
matrix:
  include:
    - node_js: "0.10"
      env: BIN="istanbul" BUILD="modern"
git:
  depth: 10
branches:
  only:
    - master
before_install:
  - "git clone --depth=10 --branch=master git://github.com/lodash/lodash.git ./node_modules/lodash"
  - "[ $BUILD != 'compat' ] && [ $BUILD != 'modern' ] && MAKE=true || true"
  - "[ $BIN == 'istanbul' ] && npm i -g coveralls@\"~2.5.0\" istanbul@\"~0.1.0\" || true"
  - "[ $MAKE != false ] && git clone --depth=10 --branch=master git://github.com/lodash/lodash-cli.git ./node_modules/lodash-cli || true"
  - "[ $MAKE != false ] && mkdir ./node_modules/lodash-cli/node_modules && cd ./node_modules/lodash-cli/node_modules/ && ln -s ../../lodash ./lodash && cd ../../../ || true"
  - "[ $MAKE != false ] && node ./node_modules/lodash-cli/bin/lodash modularize $BUILD exports=node -o ./$BUILD || true"
script:
  - "[ $BIN == 'istanbul' ] && $BIN cover --report lcovonly ./node_modules/lodash/test/test.js -- ./modern/index.js && cat ./coverage/lcov.info | coveralls && rm -rf ./coverage || true"
  - "[ $BIN != 'node' ] && true || $BIN ./node_modules/lodash/test/test.js ./$BUILD"
